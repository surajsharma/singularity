<div>
    <div id="header" style="width: 100%; display: flex; flex-direction: row; margin-top: -90px;">
        <div style="width: 100%; display: flex; flex-direction:column;">
            <h1 style="width: 100%; display: flex; justify-content:space-between; align-items: center;">
                <a id="title" href="/">{{ site.title }}</a>
                <div>
                    <a id="darkmode-icon" href="#0"></a>
                    <a id="search-icon" href="/singularity/src/search">🔎</a>
                </div>
            </h1>
        </div>
    </div>
</div>

<script>

    // environment
    let urlprefix = "";

    // dark mode
    let dm = localStorage.getItem("singularity_theme");
    let dmt = document.getElementById("darkmode-icon");

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!dm) {
            localStorage.setItem("singularity_theme", e.matches ? "dark" : "light");
        }
    });

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        // dark mode
        if (!dm) {
            dm = "dark";
            localStorage.setItem("singularity_theme", dm);
        }

        document.documentElement.style.filter = `invert(${dm === "dark" ? 1 : 0})`;
        dmt.innerText = dm === "dark" ? "☀️" : "🌙";

    }

    const toggleDarkMode = () => {
        dm = dm === "dark" ? "light" : "dark";
        document.documentElement.style.filter = `invert(${dm === "dark" ? 1 : 0})`;
        dmt.innerText = dm === "dark" ? "☀️" : "🌙";
        localStorage.setItem("singularity_theme", dm);
    }

    document.documentElement.style.filter = `invert(${dm === "dark" ? 1 : 0})`;
    dmt.addEventListener("click", toggleDarkMode);
</script>

{% if jekyll.environment == "production" %}
<script>
    urlprefix = "singularity";
</script>
{% endif %}

<script src="{{ site.baseurl }}{% link assets/js/search-worker.js %}"></script>

<script>
    const worker = new Worker("{{ site.baseurl }}{% link assets/js/search-worker.js %}");

    const redundant_title = document.querySelector('h1');
    if (redundant_title) {
        redundant_title.style.opacity = 0;
    }

    const title = document.getElementById("title");
    if (title) {
        title.href = urlprefix == "" ? "/" : "/" + urlprefix;
    }

    const search = document.getElementById("search-icon");

    if (search) {
        search.href = urlprefix == "" ? "/src/search" : "/" + urlprefix + "/src/search";
    }

</script>

<script defer src="{{ site.baseurl }}{% link assets/js/sync-search.js %}"></script>