## Lifetimes

- Newer Rust developers are often taught to think of lifetimes as corresponding to scopes

- That’s often correct, and usually useful, but the reality is a little more complex.

- A lifetime is really a name for a region of code that some reference must be valid for.

- While a lifetime will frequently coincide with a scope, it does not have to

### Lifetimes and Borrow Checker

- At the heart of Rust lifetimes is the borrow checker.

- [[03-mental models for memory]]

```rs 
use rand::Rng;  
let mut x = Box::new(42.0);
let r = &x; // 1 Lifetime starts = 'a
if rand::thread_rng().gen_bool(0.5) {
    *x = 84.0; 
    // 2 no conflicting borrows found, r is never used
} else {
    // *x = 84.0; this will fail, already borrowed below
    println!("{}", r); // 3 // 'a
}
//4 lifetime ends
```
[Listing 1-8](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=9e684df45f4ccbf3cdcc4fa20f35dcf8)

- Lifetimes can get quite convoluted. 
  
- you can see an example of a lifetime that has ___holes___, where it’s intermittently invalid between where it starts and where it ultimately ends.

```rs 
    let mut x = Box::new(42);
    let mut z = &x; // 'a -> 1 lifetime starts
    for i in 0..100 {
        println!("{}", z); // 'a -> 2
        //3 move out of x, which ends the lifetime 'a 
        x = Box::new(i);
        z = &x; // 'a -> 4  restart the lifetime
    }
    println!("{}", z); // 'a
```
[Listing 1-9, "holes in lifetime"](https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=7406042b1b57fa34502acc46b41e6bc0)

- When we reassign `z` later, we are creating an entirely new variable that exists only from that point forward. 

- It just so happens that that new variable is also named `z`. 

### Generic Lifetimes 

- Occasionally you need to store references within your own types. 
- Those references need to have a lifetime so that the borrow checker can check their validity
- ___especially true if you want a method on your type to return a reference that outlives the reference to self___


### Lifetime Variance

[//begin]: # "Autogenerated link references for markdown compatibility"
[03-mental models for memory]: <03-mental models for memory> "03-mental models for memory"
[//end]: # "Autogenerated link references"